pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- a game about trees
-- by john

function _init()
 map_init()
 init_sprites()
 trees_init()
	player=make_sprite(48,48,25)
	player.anim_frame=0
end

speed=1

function anim_player()
 player.anim_frame+=0.1
 if player.anim_frame > 4 then
  player.anim_frame-=4
 end
 player.frame=player.base_frame+player.anim_frame
end

function _update()
 local dx,dy
 dx=0
 dy=0
 
 if btn(0) then
  dx-=speed
  player.flipped=true
  player.base_frame=25
 elseif btn(1) then
  dx+=speed
  player.base_frame=25
  player.flipped=false
 elseif btn(2) then
  dy-=speed
  player.base_frame=41
  player.flipped=false
 elseif btn(3) then
  dy+=speed
  player.base_frame=9
  player.flipped=false
 end
  
 if (dx~=0) or (dy~=0) then
  local npx=player.x+dx
  local npy=player.y+dy
  if npx>=0 and npx<256 and
     npy>=1 and npy<256 and
     not tree_collide(
      npx,npy) then
   move_sprite(player,dx,dy)
   anim_player()
  end
  
  local cx,cy
  cx=max(0,min(npx-64,128))
  cy=max(0,min(npy-64,128))
  camera(cx,cy)
 end
end

function _draw()
	cls()
	
	// night mode
	--pal(4,5)
	--pal(5,0)
	--pal(3,1)
	--pal(11,3)
	
	// draw the grass
	map(0,0,0,0,32,32)
	
	// draw the map
 palt(12,true)
 palt(0,false)
 	 
	draw_sprites()

 pal()	
end
-->8
-- ★★sprites★★
sprites={}
sprites_sorted=false

function init_sprites()
end

function sprcmp(a,b)
 local diff=a.y-b.y
 if (diff~=0) return diff
 return a.x-b.x
end

function isort(t, cmp)
 for i=2,#t do
  local j=i
  while(j>1 and cmp(t[j-1],t[j])>0) do
   local tx=t[j-1]
   t[j-1]=t[j]
   t[j]=tx
   j-=1
  end
 end
end

function draw_sprites()
 if not sprites_sorted then
  isort(sprites, sprcmp)
  sprites_sorted=true
 end

 for i=1,#sprites do
  local obj=sprites[i]
  local ox=(obj.w*8)/2
  local oy=(obj.h*8)
  spr(obj.frame,
   obj.x-ox,obj.y-oy,
   obj.w,obj.h,
   obj.flipped)
 end
end

function make_sprite(x,y,frame)
 local obj={
  x=x,y=y,
  w=1,h=1,
  flipped=false,
  frame=frame
 }
 add(sprites, obj)
 sprites_sorted=false
 return obj
end

function move_sprite(obj,dx,dy)
 obj.x+=dx
 obj.y+=dy
 sprites_sorted=false
end
-->8
-- ░ trees ░
trees={}
tree_kind={
 {s=84,w=1,h=1,b=1},
 {s=69,w=1,h=1,b=1}, 
 {s=85,w=1,h=1,b=1}, 
 {s=100,w=2,h=2,b=2}, 
 {s=70,w=2,h=2,b=3}, 
 {s=102,w=2,h=2,b=4}, 
 {s=64,w=4,h=4,b=8},
}

function trees_init()
 local cnt=6
 local gs=(256-32)/cnt

	local tx,ty,tree,kind
	for ty=0,cnt do
	 for tx=0,cnt do
	  kind=tree_kind[
	   flr(rnd(#tree_kind)+1)]
	 
	  tree=make_sprite(
	   flr((tx*gs)+rnd(16)+16),
	   flr((ty*gs)+rnd(16)+32),
	   kind.s)
	  tree.w=kind.w
	  tree.h=kind.h
	  tree.b=kind.b
	  add(trees, tree)
	 end
	end
end

function tree_collide(x,y)
 for tree in all(trees) do
  if y==tree.y then
   if abs(x-tree.x)<tree.b then
    return true
   end
  end
 end
 
 return false
end

-->8
-- map stuff
function map_init()
 local mx,my,ti
  
 for my=0,31 do
  for mx=0,31 do
   ti=flr(rnd(3)+17)
   mset(mx,my,ti)
  end
 end
end

__gfx__
00000000444444444444444444444444cccccccccc00000ccccccccc0000000000000000ccc00cccccc00cccccc00cccccc00ccc000000000000000000000000
00000000444444444444444444444444cccccccccc044430cccccccc0000000000000000cc0aa0cccc0aa0cccc0aa0cccc0aa0cc000000000000000000000000
00700700444445444444454444444544ccccc00cc03343330ccccccc0000000000000000c006600cc006600cc006600cc006600c000000000000000000000000
00077000444444444444444444444444cccc03300434000440cccccc00000000000000000c0660c00c0660c00c0660c00c0660c0000000000000000000000000
00077000444444444444444444444444ccccc00333340cc030cccccc00000000000000000cc00cc00cc00cc00cc00cc00cc00cc0000000000000000000000000
00700700445444444454444444544444cccc003330034000340ccccc0000000000000000cc0660cccc0650cccc0660cccc0560cc000000000000000000000000
00000000444444444444444444444444ccc034440cc0440c0330cccc0000000000000000cc0560cccc0660cccc0650cccc0660cc000000000000000000000000
00000000444444444444444444444444cccc034330c040cc03330ccc0000000000000000ccc00cccccc00cccccc00cccccc00ccc000000000000000000000000
00000000333333333333333333333333ccc0340003043400403430cc0000000000000000ccc00cccccc00cccccc00cccccc00ccc000000000000000000000000
00000000333333333333333333333333ccc030cc040340440c040ccc0000000000000000cc06a0cccc06a0cccc06a0cccc06a0cc000000000000000000000000
000000003333333333333333333333b3ccc0330034044033303330cc0000000000000000cc0060cccc0060cccc0060cccc0060cc000000000000000000000000
00000000333333333333333333333333cc034043434434000440430c0000000000000000cc06000ccc06000ccc06000ccc06000c000000000000000000000000
00000000333333333333333333333333ccc00c00000440ccc00c030c0000000000000000ccc00cccccc00cccccc00cccccc00ccc000000000000000000000000
00000000333333333333333333333333ccc030cccc04300000cc040c0000000000000000cc0660cccc0560cccc0650cccc0660cc000000000000000000000000
0000000033333b333333333333333333cc034400c0434443440030cc0000000000000000cc0560cccc0660cccc0660cccc0650cc000000000000000000000000
00000000333333333333333333333333cc0034430c04300030330ccc0000000000000000ccc00cccccc00cccccc00cccccc00ccc000000000000000000000000
00000000000000000000000000000000c03300040054440034030ccc0000000000000000ccc00cccccc00cccccc00cccccc00ccc000000000000000000000000
00000000000000000000000000000000c040ccc044543440404400cc0000000000000000cc0660cccc0660cccc0660cccc0660cc000000000000000000000000
00000000000000000000000000000000cc0300034033430c0c04430c0000000000000000c006600cc006600cc006600cc006600c000000000000000000000000
00000000000000000000000000000000c0343330004444000cc000cc00000000000000000c0660c00c0660c00c0660c00c0660c0000000000000000000000000
00000000000000000000000000000000c040040cc05334444003430c00000000000000000cc00cc00cc00cc00cc00cc00cc00cc0000000000000000000000000
00000000000000000000000000000000cc0cc03000343403334000cc0000000000000000cc0560cccc0660cccc0650cccc0660cc000000000000000000000000
00000000000000000000000000000000c030cc0340444400340cc00c0000000000000000cc0660cccc0650cccc0660cccc0560cc000000000000000000000000
00000000000000000000000000000000c040004334453344434004300000000000000000ccc00cccccc00cccccc00cccccc00ccc000000000000000000000000
0000000000000000000000000000000003030333004344003440300c000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000c0c0c0000044440c000c0ccc000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccc054440ccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccc054440ccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccc054440ccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccc044440ccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccc054440ccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccc054440ccccccccc000000000000000000000000000000000000000000000000000000000000000000000000
cccc0000000cccc0000ccc00000ccccc00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
cc00333333300c03333000333330cccc00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
c0333333333330333333333333330ccc00000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
033333333333333333333333333330cc00000000ccc00cccccccc00ccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
033333333333333353333333333330cc00000000cc0330cccccc03300c00cccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
0333333333343334353333333333300c00000000c03330ccccc0333330330ccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
0333333333404334333333333333333000000000c03430ccccc03333333330cccccccccccccccccccccccccccccccccc00000000000000000000000000000000
0333333333444054035533333333333000000000cc040ccccc033333333330cccccccccccccccccccccccccccccccccc00000000000000000000000000000000
03333353334540440033334433333330ccccccccccc00ccccc033443334330cccccccccccccccccccccccccccccccccc00000000000000000000000000000000
0353333333344440c033344443333330cccccccccc0330cccc033444444330cccccccccccccccccccccccccccccccccc00000000000000000000000000000000
0353333334344440cc03345443353330ccccccccc033330ccc03334444330ccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
03353355343444440cc0444444333330cccccccc03343330ccc003344430cccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
c0335333333344440c04554444333330ccc0cccc0334430cccccc004400ccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
c0333333334344444045544443333330cc030cccc00400cccccccc0440cccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
cc003355333354444455444443333330c03330cccc040cccccccc04440cccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccc03333333445554444444444533330cc040ccccc040ccccccc0444440ccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
cccc0333000454454444444000353330cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccc000cc04454444444440c035330ccccccccccccccccccccc0000cccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccccccccc044444444440ccc0330ccccccccccccccccccccc0333300cc00cccccccccccccccccccccccccccccccccc00000000000000000000000000000000
cccccccccccc0454544440ccccc00ccccccccccccccccccccc0353333300330ccccccccccccccccccccccccccccccccc00000000000000000000000000000000
cccccccccccc044444440cccccccccccccccccccccccccccc03333333333330ccccccccccccccccccccccccccccccccc00000000000000000000000000000000
cccccccccccc0445444440ccccccccccccccccccccccccccc033433443333330cccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccccccccccc045444440cccccccccccccccc0000cccccc0353444433344330cccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccccccccccc0454444440cccccccccccccc033330ccccc0353454333444330cccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccccccccccc0454444440ccccccccccccc03333330ccccc03334444444330ccccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccccccccccc0444444440cccccccccccc033333330cccccc033354443300cccccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccccccccccc05544444440ccccccccccc0334344330cccccc003544430cccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccccccccccc04544444440cccccccccccc03444430ccccccccc044400ccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
cccccccccccc004544444440ccccccccccccc004400cccccccccc04440cccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccccccccc0444444444440cccccccccccccc0440ccccccccccc05440cccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
ccccccccc0044544444444440cccccccccccc04440ccccccccc00444400ccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
cccccccc044554444444444440ccccccccccc044440ccccccc0444444440cccccccccccccccccccccccccccccccccccc00000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000060006000000000000000600060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001516000000000000151615160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000006000000000000000605060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0015160000000000000000151615160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000600060000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001516150015160000000015160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000006050605060006000605060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001516151615161516151615160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0506050605060506050605060506050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1516151615161516151615161516151600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0506050605060506050605060506050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1516151615161516151615161516151600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0506050605060506050605060506050600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1516151615161516151615161516151600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
