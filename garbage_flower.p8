pico-8 cartridge // http://www.pico-8.com
version 35
__lua__
-- "a pretty flower"
-- by john doty

-- based on what i saw in
-- https://youtu.be/s6kxh_zyiqs
-- https://pyrofoux.itch.io/tea-garden

local flower_scale=2
local flower_size=6
local actual_scale=0

function _init()
 flower:init(64)
end

function _update()
 if btnp(‚¨ÜÔ∏è) and flower_size<64 then
  flower_size+=2
  the_flower=nil
  actual_scale=0
 end
 if btnp(‚¨áÔ∏è) and flower_size>2 then
  flower_size-=2
  the_flower=nil
  actual_scale=0
 end
 if btnp(‚¨ÖÔ∏è) and flower_scale>1 then
  flower_scale-=1
 end
 if btnp(‚û°Ô∏è) and flower_scale<10 then
  flower_scale+=1
 end

 if btnp(‚ùé) or btnp(üÖæÔ∏è) or the_flower==nil then
  the_flower=flower:new(flower_size,0)
  actual_scale=0
 end

 actual_scale=mid(0,actual_scale+0.1,flower_scale)
end

function princ(txt,y,col)
 local x=64-flr((4*#txt-1)/2)
 print(txt,x,y,col)
end

function _draw()
 cls()
 princ("a pretty flower", 16, 7)
 princ("of "..tostr(flower_size).." pixels", 22, 7)
 the_flower:draw(64,72,actual_scale)
 princ("name: "..the_flower.name,84,7)
 princ("seed: "..sub(tostr(the_flower.seed,0x3),7), 90, 7)
 princ("press üÖæÔ∏è or ‚ùé for another", 96, 7)
 princ("‚¨ÜÔ∏è and ‚¨áÔ∏è to grow and shrink", 102, 7)
 princ("‚¨ÖÔ∏è and ‚û°Ô∏è to zoom", 108, 7)
end
-->8
-- actual flower stuff.
flower={}
function flower:init(sy)
  flower.sy=sy
end

function flip_coin()
  if (flr(rnd(2))==0) return false
  return true
end

function rnd_chr(s)
  local i=flr(rnd(#s))+1
  return sub(s,i,i)
end

function flower:name()
  local cons="wrtpsdfghjklzxcvbnm"
  local vowl="aeiou"

  local result=rnd_chr(cons)..rnd_chr(vowl)
  if flip_coin() then
    result=result..rnd_chr(cons)..rnd_chr(vowl)
  else
    result=result..rnd({"th","ch","ph","ke","te","se"})
  end

  return result
end

function flower:new(size, slot, seed, stem)
  seed=seed or rnd()
  if stem==nil then stem=true end
  srand(seed)

  local flx=flip_coin()

  local f={
    size=size,
    seed=seed,
    stem=stem,
    symm=flr(rnd(2)),
    flx=flx,
    slot=slot,
    name=self:name()
  }

  local colors={}
  while colors[4]==colors[5] do
    colors={
      0,0,0,
      flr(rnd(8)+8),
      flr(rnd(8)+8)
    }
  end

  -- Flowers are rendered into the sprite sheet starting
  -- at y 64 and left-to-right at slot*size. So if size
  -- is 6, which is typical, then the first one is at (0,64)
  -- and the next one is at (6,64), etc.
  local symm=f.symm
  for y=0,size-1 do
    for x=0,size-1 do
      local c=rnd(colors)
      sset(x+(slot*size),y+self.sy,c)
      if symm==0 then
        sset(y+(slot*size),x+self.sy,c)
      else
        sset(size-1-x+(slot*size),y+self.sy,c)
      end
    end
  end

  return setmetatable(f,{__index=self})
end

function flower:draw(x,y,scale)
 local sz=self.size
 local flx=self.flx

 if self.stem then
  palt(0, false)
  palt(12, true)

  local sx=flr(x-16*scale/2)
  local sy=flr(y-16*scale)

  -- stem sprite starts at sprite 100
  -- because that's an empty space in
  -- all the sprite sheets i care about.
  -- :)
  sspr(
   32+16*self.symm,48,16,16,
   sx,sy,16*scale,16*scale,
   flx)

  palt()
 end

 local fx=flr(x-sz*scale/2)
 local fy=flr(y-(16+sz)*scale/2)

 function go(dx,dy)
    sspr(
       self.slot*sz,flower.sy,sz,sz,
       fx+dx,fy+dy,sz*scale,sz*scale,
       flx)
 end

 for c=1,16 do pal(c,0) end
 for dy=-1,1 do
    for dx=-1,1 do
       go(dx,dy)
    end
 end
 pal()

 go(0,0)
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000bbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000bb00bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000003b000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000003b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000bb0bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000003bbbbb00000000000000bb03b00000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000003330b0000000000000033bbb00bb0000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000003b0000000000000003bb0b330000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000003b0000000000000003bb3000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000003b000000000000003b00000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000003b000000000000003b00000000000000000000000000000000000000000000000000000000000000000000000
